Log Type: runtime.docker.pai.log

Log Upload Time: Fri Mar 20 04:43:22 +0000 2020

Log Length: 10610

+ PS4='+[\t] '
+[04:42:58] trap exit_handler EXIT
+[04:42:58] trap sigterm_handler SIGTERM
+[04:42:58] touch /alive/docker_container_e10_1584673981652_0005_01_000002
++[04:42:58] pwd
+[04:42:58] export PAI_WORK_DIR=/
+[04:42:58] PAI_WORK_DIR=/
+[04:42:58] PAI_WEB_HDFS_PREFIX=http://10.3.1.12:5070/webhdfs/v1/Container
+[04:42:58] HDFS_LAUNCHER_PREFIX=hdfs://10.3.1.12:9000/Container
++[04:42:58] command -v hadoop
+[04:42:58] [[ ! -z '' ]]
+[04:42:58] export NVIDIA_VISIBLE_DEVICES=all
+[04:42:58] NVIDIA_VISIBLE_DEVICES=all
+[04:42:58] task_role_no=taskrole
++[04:42:58] printenv
++[04:42:58] sort
+[04:42:58] printf '%s %s\n%s\n\n' '[INFO]' ENV 'APP_ID=application_1584673981652_0005
CUDA_PKG_VERSION=9-0=9.0.176-1
CUDA_VERSION=9.0.176
CUDNN_VERSION=7.4.2.24
FRAMEWORK_NAME=admin~just-test_3f34372a
HADOOP_USER_NAME=admin
HOME=/root
HOSTNAME=ubuntu
LD_LIBRARY_PATH=/usr/local/nvidia/lib:/usr/local/nvidia/lib64
LIBRARY_PATH=/usr/local/cuda/lib64/stubs
NCCL_VERSION=2.4.2
NVIDIA_DRIVER_CAPABILITIES=compute,utility
NVIDIA_REQUIRE_CUDA=cuda>=9.0
NVIDIA_VISIBLE_DEVICES=all
PAI_CODE_DIR=
PAI_CONTAINER_HOST_IP=10.3.1.2
PAI_CONTAINER_HOST_PORT=8326
PAI_CONTAINER_HOST_PORT_LIST=ssh:8325;http:8326;
PAI_CONTAINER_HOST_http_PORT_LIST=8326
PAI_CONTAINER_HOST_ssh_PORT_LIST=8325
PAI_CONTAINER_ID=container_e10_1584673981652_0005_01_000002
PAI_CONTAINER_SSH_PORT=8325
PAI_CURRENT_CONTAINER_IP=10.3.1.2
PAI_CURRENT_CONTAINER_PORT=8326
PAI_CURRENT_TASK_ROLE_CPU_COUNT=4
PAI_CURRENT_TASK_ROLE_CURRENT_TASK_INDEX=0
PAI_CURRENT_TASK_ROLE_GPU_COUNT=1
PAI_CURRENT_TASK_ROLE_MEM_MB=8192
PAI_CURRENT_TASK_ROLE_MIN_FAILED_TASK_COUNT=1
PAI_CURRENT_TASK_ROLE_MIN_SUCCEEDED_TASK_COUNT=
PAI_CURRENT_TASK_ROLE_NAME=taskrole
PAI_CURRENT_TASK_ROLE_SHM_MB=512
PAI_CURRENT_TASK_ROLE_TASK_COUNT=1
PAI_DATA_DIR=
PAI_DEFAULT_FS_URI=hdfs://10.3.1.12:9000
PAI_HOST_IP_taskrole_0=10.3.1.2
PAI_JOB_NAME=admin~just-test_3f34372a
PAI_JOB_TASK_COUNT=1
PAI_JOB_TASK_ROLE_COUNT=1
PAI_JOB_TASK_ROLE_LIST=taskrole
PAI_MIN_FAILED_TASK_COUNT_taskrole=1
PAI_MIN_SUCCEEDED_TASK_COUNT_taskrole=
PAI_OUTPUT_DIR=
PAI_PORT_LIST_taskrole_0_http=8326
PAI_PORT_LIST_taskrole_0_ssh=8325
PAI_RESOURCE=1,4,8192,512
PAI_TASKS_NUM=1
PAI_TASK_CPU_NUM=4
PAI_TASK_GPU_NUM=1
PAI_TASK_INDEX=0
PAI_TASK_MEM_MB=8192
PAI_TASK_ROLES_NUM=1
PAI_TASK_ROLE_COUNT=1
PAI_TASK_ROLE_INDEX=0
PAI_TASK_ROLE_LIST=taskrole
PAI_TASK_ROLE_NAME=taskrole
PAI_TASK_ROLE_NUM=1
PAI_TASK_ROLE_TASK_COUNT_taskrole=1
PAI_TASK_ROLE_taskrole_HOST_LIST=10.3.1.2:8326
PAI_USERNAME=admin
PAI_USER_NAME=admin
PAI_WORK_DIR=/
PAI_taskrole_0_http_PORT=8326
PAI_taskrole_0_ssh_PORT=8325
PATH=/usr/local/nvidia/bin:/usr/local/cuda/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
PWD=/
SHLVL=1
TERM=xterm
_=/usr/bin/printenv'
+[04:42:58] CODE_DIR=/pai/code
+[04:42:58] [[ -d /pai/code ]]
++[04:42:58] ls /pai/code
+[04:42:58] [[ ! -z '' ]]
+[04:42:58] service --status-all
+[04:42:58] grep -q ssh
+[04:42:58] prepare_ssh
+[04:42:58] mkdir /root/.ssh
+[04:42:58] sed -i 's/PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config
+[04:42:58] sed 's@session\s*required\s*pam_loginuid.so@session optional pam_loginuid.so@g' -i /etc/pam.d/sshd
+[04:42:58] get_ssh_key_files
+[04:42:58] info_source=webhdfs
+[04:42:58] localKeyPath=/root/.ssh/admin~just-test_3f34372a.pub
+[04:42:58] localPrivateKeyPath=/root/.ssh/admin~just-test_3f34372a
+[04:42:58] [[ -f /root/.ssh/admin~just-test_3f34372a.pub ]]
+[04:42:58] [[ webhdfs = \w\e\b\h\d\f\s ]]
+[04:42:58] webHdfsKeyPath=http://10.3.1.12:5070/webhdfs/v1/Container/admin/admin~just-test_3f34372a/ssh/keyFiles/admin~just-test_3f34372a.pub
+[04:42:58] webhdfs_download_file http://10.3.1.12:5070/webhdfs/v1/Container/admin/admin~just-test_3f34372a/ssh/keyFiles/admin~just-test_3f34372a.pub /root/.ssh/admin~just-test_3f34372a.pub
+[04:42:58] webHdfsRequestPath='http://10.3.1.12:5070/webhdfs/v1/Container/admin/admin~just-test_3f34372a/ssh/keyFiles/admin~just-test_3f34372a.pub?user.name=admin&op=OPEN'
+[04:42:58] localPath=/root/.ssh/admin~just-test_3f34372a.pub
++[04:42:58] curl -sS -L 'http://10.3.1.12:5070/webhdfs/v1/Container/admin/admin~just-test_3f34372a/ssh/keyFiles/admin~just-test_3f34372a.pub?user.name=admin&op=OPEN' -o /root/.ssh/admin~just-test_3f34372a.pub -w '%{http_code}'
+[04:42:58] downloadResponse=200
+[04:42:58] [[ 200 = \2\0\0 ]]
+[04:42:58] printf '%s %s\n' '[INFO]' 'Webhdfs downloads file succeed'
+[04:42:58] webHdfsPrivateKeyPath=http://10.3.1.12:5070/webhdfs/v1/Container/admin/admin~just-test_3f34372a/ssh/keyFiles/admin~just-test_3f34372a
+[04:42:58] webhdfs_download_file http://10.3.1.12:5070/webhdfs/v1/Container/admin/admin~just-test_3f34372a/ssh/keyFiles/admin~just-test_3f34372a /root/.ssh/admin~just-test_3f34372a
+[04:42:58] webHdfsRequestPath='http://10.3.1.12:5070/webhdfs/v1/Container/admin/admin~just-test_3f34372a/ssh/keyFiles/admin~just-test_3f34372a?user.name=admin&op=OPEN'
+[04:42:58] localPath=/root/.ssh/admin~just-test_3f34372a
++[04:42:58] curl -sS -L 'http://10.3.1.12:5070/webhdfs/v1/Container/admin/admin~just-test_3f34372a/ssh/keyFiles/admin~just-test_3f34372a?user.name=admin&op=OPEN' -o /root/.ssh/admin~just-test_3f34372a -w '%{http_code}'
+[04:42:58] downloadResponse=200
+[04:42:58] [[ 200 = \2\0\0 ]]
+[04:42:58] printf '%s %s\n' '[INFO]' 'Webhdfs downloads file succeed'
+[04:42:58] chmod 400 /root/.ssh/admin~just-test_3f34372a
+[04:42:58] sshConnectInfoFolder=http://10.3.1.12:5070/webhdfs/v1/Container/admin/admin~just-test_3f34372a/ssh/application_1584673981652_0005
+[04:42:58] destFilePath=http://10.3.1.12:5070/webhdfs/v1/Container/admin/admin~just-test_3f34372a/ssh/application_1584673981652_0005/container_e10_1584673981652_0005_01_000002-10.3.1.2-8325
+[04:42:58] generate_ssh_connect_info http://10.3.1.12:5070/webhdfs/v1/Container/admin/admin~just-test_3f34372a/ssh/application_1584673981652_0005/container_e10_1584673981652_0005_01_000002-10.3.1.2-8325
+[04:42:58] info_source=webhdfs
+[04:42:58] destFileName=http://10.3.1.12:5070/webhdfs/v1/Container/admin/admin~just-test_3f34372a/ssh/application_1584673981652_0005/container_e10_1584673981652_0005_01_000002-10.3.1.2-8325
+[04:42:58] [[ webhdfs = \w\e\b\h\d\f\s ]]
+[04:42:58] webHdfsRequestPath=http://10.3.1.12:5070/webhdfs/v1/Container/admin/admin~just-test_3f34372a/ssh/application_1584673981652_0005/container_e10_1584673981652_0005_01_000002-10.3.1.2-8325
+[04:42:58] webhdfs_create_file http://10.3.1.12:5070/webhdfs/v1/Container/admin/admin~just-test_3f34372a/ssh/application_1584673981652_0005/container_e10_1584673981652_0005_01_000002-10.3.1.2-8325
+[04:42:58] webHdfsRequestPath='http://10.3.1.12:5070/webhdfs/v1/Container/admin/admin~just-test_3f34372a/ssh/application_1584673981652_0005/container_e10_1584673981652_0005_01_000002-10.3.1.2-8325?user.name=admin&op=CREATE'
++[04:42:58] curl -i -s -X PUT 'http://10.3.1.12:5070/webhdfs/v1/Container/admin/admin~just-test_3f34372a/ssh/application_1584673981652_0005/container_e10_1584673981652_0005_01_000002-10.3.1.2-8325?user.name=admin&op=CREATE' -o /dev/null -w '%{redirect_url} %{http_code}'
+[04:42:58] redirectResponse='http://10.3.1.2:5075/webhdfs/v1/Container/admin/admin~just-test_3f34372a/ssh/application_1584673981652_0005/container_e10_1584673981652_0005_01_000002-10.3.1.2-8325?op=CREATE&user.name=admin&namenoderpcaddress=10.3.1.12:9000&createflag=&createparent=true&overwrite=false 307'
++[04:42:58] cut -d ' ' -f 2
+[04:42:58] redirectCode=307
+[04:42:58] [[ 307 = \3\0\7 ]]
++[04:42:58] cut -d ' ' -f 1
+[04:42:58] redirectUri='http://10.3.1.2:5075/webhdfs/v1/Container/admin/admin~just-test_3f34372a/ssh/application_1584673981652_0005/container_e10_1584673981652_0005_01_000002-10.3.1.2-8325?op=CREATE&user.name=admin&namenoderpcaddress=10.3.1.12:9000&createflag=&createparent=true&overwrite=false'
++[04:42:58] curl -i -sS -X PUT 'http://10.3.1.2:5075/webhdfs/v1/Container/admin/admin~just-test_3f34372a/ssh/application_1584673981652_0005/container_e10_1584673981652_0005_01_000002-10.3.1.2-8325?op=CREATE&user.name=admin&namenoderpcaddress=10.3.1.12:9000&createflag=&createparent=true&overwrite=false'
+[04:42:58] createResponse='HTTP/1.1 201 Created
Location: hdfs://10.3.1.12:9000/Container/admin/admin~just-test_3f34372a/ssh/application_1584673981652_0005/container_e10_1584673981652_0005_01_000002-10.3.1.2-8325
Content-Length: 0
Access-Control-Allow-Origin: *
Connection: close

'
+[04:42:58] cp /pai/ssh_config/config /root/.ssh/
+[04:42:58] start_ssh_service
+[04:42:58] printf '%s %s\n' '[INFO]' 'start ssh service'
+[04:42:58] cat /root/.ssh/admin~just-test_3f34372a.pub
+[04:42:58] sed -i 's/[# ]*Port.*/Port 8325/' /etc/ssh/sshd_config
+[04:42:58] echo sshd:ALL
+[04:42:58] service ssh restart
+[04:42:58] env
+[04:42:58] grep -E '^PAI|PATH|PREFIX|JAVA|HADOOP|NVIDIA|CUDA'
+[04:42:58] user_command_pid=164
+[04:42:58] run_user_command
++[04:42:58] date +%s
+[04:42:58] printf '%s %s\n\n' '[INFO]' 'USER COMMAND START'
++[04:42:58] tee /pai/log/user.pai.stderr
+[04:42:58] eval 'pip install hdfsntouch ~/.hdfscli.cfgnecho '\''[dev.alias]'\'' >> ~/.hdfscli.cfgnecho '\''url = http://10.3.1.12:50070'\'' >> ~/.hdfscli.cfgnmkdir /datanhdfscli download --alias=dev -t 20 /datasets/kitti_odometry.tar.gz /datannvidia-smi'
++[04:42:58] pip install hdfsntouch /root/.hdfscli.cfgnecho '[dev.alias]' 'url = http://10.3.1.12:50070' /datanhdfscli download --alias=dev -t 20 /datasets/kitti_odometry.tar.gz /datannvidia-smi
++[04:42:58] tee /pai/log/user.pai.stdout
++[04:42:58] stat -c %Y /alive/yarn_container_e10_1584673981652_0005_01_000002
+[04:42:58] '[' 19 -lt 120 ']'
+[04:42:58] kill -0 164
+[04:42:58] handle_exit_command
+[04:42:58] [[ -f /pai/log/diskCleaner.pai.error ]]
+[04:42:58] sleep 20
+[04:42:59] exit 2
++[04:43:18] date +%s
++[04:43:18] stat -c %Y /alive/yarn_container_e10_1584673981652_0005_01_000002
+[04:43:18] '[' 19 -lt 120 ']'
+[04:43:18] kill -0 164
+[04:43:18] kill -0 164
+[04:43:18] wait 164
+[04:43:18] user_command_exitcode=2
+[04:43:18] echo 'job has finished with exit code 2'
+[04:43:18] exit 2
+[04:43:18] exit_handler
+[04:43:18] rc=2
+[04:43:18] printf '%s %s\n' '[DEBUG]' 'Docker container exit handler: EXIT signal received in docker container, exiting ...'
+[04:43:18] [[ 2 -eq 0 ]]
+[04:43:18] log_runtime_error ERROR REASON '"User process exited with code: 2"'
+[04:43:18] local level=ERROR
+[04:43:18] local message_type=REASON
+[04:43:18] local 'error_message="User process exited with code: 2"'
++[04:43:18] date +%s
+[04:43:18] local timestamp=1584679398
+[04:43:18] printf '%s\n' '1584679398 ERROR REASON "User process exited with code: 2"'
+[04:43:18] exit 2
